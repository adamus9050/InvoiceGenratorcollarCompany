@model Application.DTOs.ProductDisplayModel

@{

}
<div my-2>
   
 <form asp-action="Index" class="row gx-3 gy-2 align-items-center">
    @* Wyszukiwanie po tytule*@
   <div class="col-sm-3">
     <label class="visually-hidden" for="sterm">Szukaj po nazwie produktu</label>
     <div class="input-group">
       <div class="input-group-text"></div>
       <input type="text" class="form-control" value="@Model.STerm" id="sterm" name="sterm" placeholder="Szukaj po nazwie produktu">
     </div>
   </div>
 @*  Wybieranie typów labelka*@
    <div class="col-auto">
     <label class="visually-hidden" for="typeId">Types</label>
     <select class="form-select" id="typeId" name="typeId">
       <option selected>Wybierz Typ</option>
       @foreach(var types in Model.Type )
       {
            <option selected="@(types.Id ==Model.TypeId)" value="@types.Id">@types.TypeName</option>         
       } 

     </select>
   </div>

   <div class="col-auto">
     <button type="submit" class="btn btn-primary">Szukaj</button>
   </div> 
 </form>
  
</div>


     <div class="w-100 mt-4 d-flex flex-wrap">
    @foreach (var product in Model.ProductSize)
    {

      <div class="card mx-2 mb-4" style="width: 16rem;">
            @if (string.IsNullOrEmpty(product.Image))
            {
                  <img width="100%" height="300px" src="/images/NoImage.png" class="card-img-top" alt="...">       

            }
            else
            {
                  <img src="/image/@product.Image" class="card-img-top" alt="...">       
            }

          <div class="card-body ">
          <h5 class="card-title"> @product.Name</h5>
          <p class="card-text">
                

           <div class="col-auto">
            <label class="visually-hidden" for="autoSizingSelect">Choose</label>

            <select class="form-select" id="sizeId">
              <option selected>Wybierz rozmiar</option>
              
              @foreach(var size in product.Sizes)
              {         
                    @*do zrobienia: Jeśli nie ma przypisanego rozmiaru to dla nieprzypisanych rozmiarów do produktów ustaw przycisk "przypisz rozmiar"*@
                  <option value="@size.Id">
                  
                   <div class="d-flex">
                     <div class="p-2 w-100">@size.NameInt @size.Namestring</div>
                        <div class="p-2 flex-shrink-1">
                     </div>
                   </div>                                    
                  </option>                                
              }
            </select>

             <select class="form-select" id="Material.Id">
             <option selected>Wybierz Matriał</option>
              @foreach (var material in Model.Material)
              { 
              <option value="@material.MaterialId">

                <div class="d-flex">
                <div class="p-2 w-100">@material.Name @material.Colour</div>
                <div class="p-2 flex-shrink-1">
                </div>
              </div>
              </option>
              }
            </select>
            </div>  <br/>
                 <b>Opis:</b> @product.Description<br/>
                 @*<b>Typ:</b>@product.Type.TypeName<br/>*@
                 <b>Cena:</b> @product.ProductPrice <br/>
          </p>
          <button type="button" onclick="add(@product.Id)" class="btn btn-primary">Dodaj do koszyka</button>
          </div>
      </div>
    }
    @section Scripts
    {
        <script>
            alert("hello");
            async function add(productId)
            {
                try{
                    var response = await fetch('/test/AddItem?productId=${productId}');
                    if(response.status==200)
                    {
                        var result = await response.json();
                        console.log(result);
                        var cartCountEl= document.getElementById(cartCount);
                        cartCountEl.innerHTML=result;
                    }
                    
                   }
                catch(err)
                {
                    console.log(err)
                }
            }
        </script>
        
    }